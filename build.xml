<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!-- WARNING: Eclipse auto-generated file.
              Any modifications will be overwritten.
              To include a user specific buildfile here, simply create one in the same
              directory with the processing instruction <?eclipse.ant.import?>
              as the first entry and export the buildfile again. -->

<project basedir="." default="cdh44" name="R4H">
    <property environment="env"/>
    <property name="debuglevel" value="source,lines,vars"/>
    <property name="target" value="1.7"/>
    <property name="source" value="1.7"/>
    <target name="cdh44">
	<property name="hadoopdir" value="/.autodirect/acclgwork/ufa/HDFS/hadoop-2.0.0-cdh4.4.0-SNAPSHOT/share/hadoop" />
	<property name="matching-src" value="r4h-cdh4.4" />
	<property name="jar-title" value="R4H-CDH44" />
	<antcall target="build" />
    </target>
    <target  name="cdh5">
	    <property name="hadoopdir" value="/.autodirect/acclgwork/ufa/HDFS/hadoop-2.3.0-cdh5.0.2/share/hadoop" />
	<property name="matching-src" value="r4h-cdh5" />
	<property name="jar-title" value="R4H-CDH5" />
	<antcall target="build" />
    </target>
    <target  name="hdp21">
	    <property name="hadoopdir" value="/.autodirect/acclgwork/ufa/HDFS/hadoop-2.4.0.HDP-2.1.2/share/hadoop" />
	<property name="matching-src" value="r4h-hdp2.1" />
	<property name="jar-title" value="R4H-HDP21" />
	<antcall target="build" />
    </target>
    <target name="init">
        <mkdir dir="build"/>
        <copy includeemptydirs="false" todir="build">
		<fileset dir="src/${matching-src}/src">
				<exclude name="**/*.java"/>
		</fileset>
		<fileset dir="src/common/src">
				<exclude name="**/*.java"/>
		</fileset>
        </copy>
        <copy includeemptydirs="false" todir="build">
            <fileset dir="test">
                <exclude name="**/*.java"/>
            </fileset>
        </copy>
    </target>
    <target name="clean">
        <delete dir="build"/>
    </target>
    <target depends="clean" name="cleanall"/>
    <target name="path-init" unless="id">

	<path id="R4H.classpath">
		<pathelement location="build"/>
		<fileset dir="${hadoopdir}/hdfs/">
			<include name="*.jar" />
		</fileset>
		<fileset dir="${hadoopdir}/common/">
			<include name="*.jar" />
		</fileset>
		<fileset dir="${hadoopdir}/hdfs/lib">
			<include name="*.jar" />
		</fileset>
		<pathelement location="jxio/bin/jxio.jar"/>
		<fileset dir="${hadoopdir}/common/lib">
			<include name="*.jar" />
		</fileset>
	</path>
    </target>

    <target depends="path-init,build-subprojects,build-project" name="build"/>
    <target name="build-subprojects"/>
    <target depends="init" name="build-project">
	    <echo message="--- ${jar-title} ---" />
	<exec outputproperty="gitver" executable="git">
		     <arg value="describe"/>
		     <arg value="--long"/>
		     <arg value="--tags"/>
		     <arg value="--always"/>
		     <arg value="--dirty"/>
	</exec>
	<echo message="${ant.project.name}: ${ant.file}"/>
	<javac debug="true" debuglevel="${debuglevel}" destdir="build" includeantruntime="false" source="${source}" target="${target}">
	
		<src path="src/${matching-src}/src"/>
		<src path="src/common/src"/>
            <src path="test"/>
            <classpath refid="R4H.classpath"/>
    </javac>

	    <jar destfile="build/r4h.jar" basedir="build/" includes="**/*.class">
	       <manifest>
		       <section	name="RDMA For HDFS">
			       <attribute name="Implementation-Title"
				       value="${jar-title}"/>
		       <attribute name="Implementation-Version" value="${gitver}"/>
		       <attribute name="Implementation-Vendor" value="Mellanox"/>
		       </section>
		</manifest>
	    </jar>
    </target>
</project>
